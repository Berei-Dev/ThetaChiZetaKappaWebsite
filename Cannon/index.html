<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <title>Hyperbolic Tree</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="dcterms.rightsHolder" content="Copyright © 2018 Glatzhofer Michael">
    
    <link rel="stylesheet" href="d3-hypertree-light.css" id="ldswitch">
    <script src="d3-hypertree.js"></script>
</head>
<body>
    <script>  
        async function loadCSV() {
            const response = await fetch("cannon.csv");
            const text = await response.text();
            return text.split("\n").map(row => row.split(",").map(cell => cell.trim()));
        }

        function buildTree(edges) {
            let nodes = {}; 

            edges.forEach(([parent, child]) => {
                if (!nodes[parent]) nodes[parent] = { name: parent, children: [] };
                if (!nodes[child]) nodes[child] = { name: child, children: [] };
                nodes[parent].children.push(nodes[child]);
            });

            return nodes[edges[0][0]]; // Return the root node
        }

        async function createHypertree() {
            const edges = await loadCSV();
            const treeData = buildTree(edges);

            const ht = new hyt.Hypertree(
                { parent: document.body },
                { 
                        langInitBFS: (ht, n) => {                
                            n.precalc.label = n.data.name;                        
                        },
                        dataloader: ok => ok(treeData),
                        interaction: {
                            λbounds: [ .05, 2 ],
                            onZoom: (ht, λ) => { 
                                ht.hyper.updateScale(Math.exp(λ)); // Adjusts scaling dynamically
                        },
                    }                 
                }
            );

            ht.initPromise
                .then(() => new Promise((ok, err) => ht.animateUp(ok, err)))            
                .then(() => ht.drawDetailFrame());
        }

        createHypertree();
    </script>
</body>
</html>